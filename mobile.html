
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=7,IE=9" />
    <meta name="viewport" content="initial-scale=1.0, width=device-width, maximum-scale=1.0, user-scalable=no"/>
    <!-- meta tags to hide url and minimize status bar to give the web app
    a native app look this only happens after app is saved to the desktop-->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="translucent-black"
    />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>
      Mobile API
    </title>
    <script type="text/javascript" src="http://serverapi.arcgisonline.com/jsapi/arcgis/?v=2.3compact">
    </script>
    <!-- Details about the Webkit CSS Properties http://css-infos.net/properties/webkit.php
    and http://www.pointabout.com/category/development-blog/pointabout-dev-help/-->
    <style type="text/css">
      html, body
      {
        height: 100%;
        margin: 0px;
        padding: 0px;
        width: 100%;
      }
     @-webkit-keyframes
       pulse
      {
        0%
        {
          opacity: 1.0;
          -webkit-transform: scale(1.25);

        }
        45%
        {
          opacity: .20;
          -webkit-transform: scale(.80);

        }
        100%
        {
          opacity: 1.0;
          -webkit-transform: scale(1.25);

        }
      }
      #map_graphics_layer
      {
        -webkit-animation-duration: 3s;
        -webkit-animation-iteration-count: infinite;
        -webkit-animation-name: pulse;
        -webkit-animation-timing-function: ease-in-out;
      }
    </style>
    <script type="text/javascript">
      dojo.require("esri.map");
      var map;
      var graphic;
      var currLocation;

      function init() {
       	 /*
	        //Add the topographic layer to the map. View the ArcGIS Online site for services http://arcgisonline/home/search.html?t=content&f=typekeywords:service    
	        var basemap = new esri.layers.ArcGISTiledMapServiceLayer("http://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer");
	        map.addLayer(basemap);

		 var dynlayer2 = new esri.layers.ArcGISDynamicMapServiceLayer("http://eos2/ArcGIS/rest/services/Misc/AGS_misc/MapServer/",{"opacity":0.5});
		        map.addLayer(dynlayer2);*/
				var initExtent = new esri.geometry.Extent({"xmin":-13204441.135492312,"ymin":4083458.830749193,"xmax":-13180611.891924439,"ymax":4089172.4986135024,"spatialReference":{"wkid":102100}});
			        map = new esri.Map("map",{extent:initExtent});
				        dojo.connect(map, "onLoad", initFunc);
				        var tiledMapServiceLayer = new esri.layers.ArcGISTiledMapServiceLayer("http://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer");
				        map.addLayer(tiledMapServiceLayer);
				
						var dynlayer2 = new esri.layers.ArcGISDynamicMapServiceLayer("http://eos2/ArcGIS/rest/services/Misc/AGS_misc/MapServer/",{"opacity":0.5});
						        map.addLayer(dynlayer2);

      }

      function orientationChanged() {
        console.log("Orientation changed: " + window.orientation);
        if(map){
          map.reposition();
          map.resize();
        }
      }


      function initFunc(map) {
        if(navigator.geolocation){  
          navigator.geolocation.getCurrentPosition(zoomToLocation, locationError);
          navigator.geolocation.watchPosition(showLocation, locationError);
        }
      }

      function locationError(error) {
        switch (error.code) {
        case error.PERMISSION_DENIED:
          alert("Location not provided");
          break;

        case error.POSITION_UNAVAILABLE:
          alert("Current location not available");
          break;

        case error.TIMEOUT:
          alert("Timeout");
          break;

        default:
          alert("unknown error");
          break;
        }

      }

      function zoomToLocation(location) {
        var pt = esri.geometry.geographicToWebMercator(new esri.geometry.Point(location.coords.longitude, location.coords.latitude));    
        map.centerAndZoom(pt, 16);
      }

      function showLocation(location) {
        //zoom to the users location and add a graphic
        var pt = esri.geometry.geographicToWebMercator(new esri.geometry.Point(location.coords.longitude, location.coords.latitude));
        if (!graphic) {
          var symbol = new esri.symbol.PictureMarkerSymbol('images/bluedot.png', 40, 40);
          graphic = new esri.Graphic(pt, symbol);
          map.graphics.add(graphic);
        }
        else { //move the graphic if it already exists
          graphic.setGeometry(pt);
        }
        console.log("Accuracy: " + location.coords.accuracy);
        console.log("Speed: " + location.coords.speed);
        map.centerAt(pt);
      }



      dojo.addOnLoad(init);
    </script>
  </head>
  
  <body onorientationchange="orientationChanged();" >
    <div id="map" style="width:100%; height:100%;">
    </div>
  </body>

</html>